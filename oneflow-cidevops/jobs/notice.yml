# å‘å¸ƒé•œåƒå®Œæˆé€šçŸ¥
.deploy_notice:
  stage: deploy_notice
  script:
    - ls
    - /home/gitlab-runner/push_notice.sh $CI_BUILD_REF_NAME $CI_PROJECT_ID cli_a34caeb0497ed00b isn1ocwBDZur8qUykuT4ohaa6A7uEtFu $CI_PROJECT_NAME "ä½ åˆšæäº¤çš„ä»£ç ï¼Œé•œåƒå·²ç»æ„å»ºå®Œæˆï¼Œå¦‚éœ€æ‰‹åŠ¨å‘å¸ƒï¼Œå¯ä»¥è¿›è¡Œå‘å¸ƒäº†ï¼"
  rules:
    - if: " $RUN_ROT_NOTICE == 'no' "
      when: never
    - when: always
  allow_failure: true

# é£ä¹¦æœºå™¨äººé€šçŸ¥
.deploy_notice_feishu:
  stage: deploy_notice_feishu
  script:
    - COMMIT_MESSAGE=$(git log --name-status  --pretty=oneline --abbrev-commit ${CI_COMMIT_BEFORE_SHA}..${CI_COMMIT_SHA} | tr '\t' ' '| sed -e ':a' -e 'N' -e '$!ba' -e 's/\n/\\n/g')
    - echo $COMMIT_MESSAGE
    - 'curl -X POST -H "Content-Type: application/json" -d "{\"msg_type\":\"interactive\",\"card\":{\"elements\":[{\"tag\":\"div\",\"text\":{\"content\":\" ** ğŸŒŸ é¡¹ç›®åç§°ï¼š** $CI_PROJECT_NAME \\n **ğŸ‰ é¡¹ç›®æ„å»ºç»“æœï¼š** æˆåŠŸ\\n **ğŸ“² æ„å»ºåˆ†æ”¯ï¼š** $CI_COMMIT_BRANCH \\n **ğŸ‘¨â€ğŸ’» æ„å»ºäººï¼š**$GITLAB_USER_NAME \\n **ğŸ“¬ æµæ°´çº¿åœ°å€ï¼š** [$CI_PIPELINE_URL]($CI_PIPELINE_URL) \\n **ğŸ“æ›´æ–°æ—¥å¿—ï¼š** \n $COMMIT_MESSAGE \\n\",\"tag\":\"lark_md\"}}],\"header\":{\"template\":\"turquoise\",\"title\":{\"content\":\"ğŸ“¢ ç‰ˆæœ¬æ›´æ–°é€šçŸ¥\",\"tag\":\"plain_text\"}}}}" https://open.feishu.cn/open-apis/bot/v2/hook/${ROBOT_KEY}'
  rules:
    - if: " $FEI_SHU_ROBOT_NOTICE == 'yes' "
      when: always
    - when: never
  allow_failure: true
